<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>도서 상세 - Kerygma Library</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@300;400;600;700&family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; background-color: #0F172A; color: #E2E8F0; }
        .font-serif { font-family: 'Noto Serif KR', serif; }
        .neon-text { text-shadow: 0 0 10px rgba(56, 189, 248, 0.3); }
        .glass-panel { background: rgba(30, 41, 59, 0.4); backdrop-filter: blur(12px); border: 1px solid rgba(148, 163, 184, 0.1); }
        
        /* Typography */
        h1, h2, h3 { font-family: 'Noto Sans KR', sans-serif; letter-spacing: -0.02em; }
        .prose p { margin-bottom: 1.2rem; line-height: 1.8; font-size: 1.05rem; color: #cbd5e1; font-family: 'Noto Serif KR', serif; }
        .prose strong { color: #f8fafc; font-weight: 700; }
        .prose a { color: #38BDF8; text-decoration: underline; text-underline-offset: 4px; }
        
        /* Quote Card */
        .quote-card {
            font-family: 'Noto Serif KR', serif;
            position: relative;
            background: linear-gradient(135deg, rgba(30,41,59,0.5), rgba(15,23,42,0.5));
            border-left: 4px solid #38BDF8;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #475569; }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center py-12 px-4 sm:px-6 lg:px-8 bg-[url('https://grainy-gradients.vercel.app/noise.svg')]">

    <!-- Navigation -->
    <nav class="w-full max-w-6xl mb-12 flex items-center justify-between">
        <a href="library.html" class="text-slate-400 hover:text-white transition-colors flex items-center gap-2 text-sm uppercase tracking-widest font-bold group">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 transform group-hover:-translate-x-1 transition-transform" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd" />
            </svg>
            Back to Library
        </a>
    </nav>

    <!-- Content Container -->
    <main id="bookContent" class="w-full max-w-6xl grid grid-cols-1 lg:grid-cols-12 gap-12 hidden opacity-0 transition-opacity duration-700 ease-out">
        
        <!-- Left Column: Cover & Sticky Actions -->
        <div class="lg:col-span-4 flex flex-col gap-8">
            <div class="sticky top-8">
                <!-- Cover -->
                <div class="glass-panel p-2 rounded-sm shadow-2xl relative group mb-8 rotate-1 hover:rotate-0 transition-transform duration-500">
                    <div class="absolute inset-0 bg-blue-500/10 blur-2xl rounded-2xl group-hover:bg-blue-500/20 transition-all duration-500"></div>
                    <img id="bookCover" src="" alt="Book Cover" class="w-full h-auto rounded-sm shadow-xl relative z-10 border border-white/10">
                </div>

                <!-- Status & Purchase -->
                <div class="flex flex-col gap-4">
                    <div class="flex justify-between items-center px-2">
                        <span class="text-slate-500 text-xs font-bold uppercase tracking-widest">Status</span>
                        <span id="bookStatusBadge" class="px-3 py-1 rounded-full text-xs font-medium border"></span>
                    </div>
                    
                    <div id="purchaseLinks" class="flex flex-col gap-3 mt-4">
                        <!-- Dynamic Buttons -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Column: Rich Content -->
        <div class="lg:col-span-8 flex flex-col gap-12">
            
            <!-- Header Group -->
            <div class="border-b border-slate-800 pb-8">
                <div class="flex flex-wrap gap-2 mb-6" id="tagContainer"></div>
                <h1 id="bookTitle" class="text-4xl md:text-5xl font-bold text-white mb-3 tracking-tight leading-tight"></h1>
                <h2 id="bookSubtitle" class="text-xl md:text-2xl text-slate-400 font-light mb-8 font-serif italic leading-relaxed"></h2>
                
                <div class="flex items-center gap-6 text-sm text-slate-300">
                    <span class="flex items-center gap-2 px-4 py-2 bg-slate-800/50 rounded-full border border-slate-700/50 hover:bg-slate-800 transition-colors">
                        <svg class="w-4 h-4 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
                        <span id="bookAuthor" class="font-bold tracking-wide"></span>
                    </span>
                </div>
            </div>

            <!-- Quotes (Highlight) -->
            <div id="quotesSection" class="hidden">
                 <div class="relative pl-4">
                    <svg class="absolute -top-6 -left-2 w-16 h-16 text-blue-500/10 z-0 opacity-50" fill="currentColor" viewBox="0 0 24 24"><path d="M14.017 21L14.017 18C14.017 16.054 15.362 14.868 17.070 14.868C17.766 14.868 18.232 15.068 18.572 15.228C18.292 13.988 16.632 12.388 13.793 11.536L14.512 9.496C19.897 11.08 22 14.78 22 18.001L22 21L14.017 21ZM5 21L5 18C5 16.054 6.345 14.868 8.051 14.868C8.749 14.868 9.215 15.068 9.553 15.228C9.274 13.988 7.616 12.388 4.774 11.536L5.495 9.496C10.879 11.08 12.983 14.78 12.983 18.001L12.983 21L5 21Z"/></svg>
                    <div id="quotesContainer" class="space-y-6 relative z-10">
                        <!-- Quotes injected here -->
                    </div>
                </div>
            </div>

            <!-- Book Description -->
            <div>
                <h3 class="text-sm font-bold text-slate-500 uppercase tracking-widest mb-6 border-l-2 border-slate-700 pl-3">About the Book</h3>
                <div id="bookDescription" class="prose max-w-none text-slate-300"></div>
            </div>

            <!-- Author Bio -->
            <div id="bioSection" class="bg-slate-900/40 p-8 rounded-xl border border-slate-800 hidden hover:border-slate-700 transition-colors">
                <h3 class="text-sm font-bold text-slate-500 uppercase tracking-widest mb-4 border-l-2 border-blue-500/50 pl-3">About the Author</h3>
                <div id="authorBio" class="text-slate-300 leading-relaxed font-serif text-lg"></div>
            </div>

        </div>
    </main>

    <!-- Error State -->
    <div id="errorState" class="hidden min-h-[50vh] flex flex-col items-center justify-center text-center">
        <h2 class="text-3xl font-bold text-slate-600 mb-4">404</h2>
        <p class="text-slate-400 mb-8">존재하지 않는 도서입니다.</p>
        <a href="library.html" class="px-6 py-3 bg-slate-800 hover:bg-slate-700 rounded-lg text-white transition-colors">
            목록으로 돌아가기
        </a>
    </div>

    <script type="module">
        import libraryData from './library_data.js';

        const urlParams = new URLSearchParams(window.location.search);
        const bookId = urlParams.get('id');
        const book = libraryData.find(b => b.id === bookId);

        if (!book) {
            document.getElementById('errorState').classList.remove('hidden');
        } else {
            const content = document.getElementById('bookContent');
            
            // Status Logic
            let statusText = book.status;
            let statusClass = "bg-slate-500/20 text-slate-400 border-slate-500/30"; 
            
            const normalizedStatus = (book.status || '').toLowerCase();
            if (normalizedStatus.includes('published') || normalizedStatus.includes('판매')) {
                statusText = '판매중';
                statusClass = "bg-green-500/10 text-green-400 border-green-500/20";
            } else if (normalizedStatus.includes('hived') || normalizedStatus.includes('out') || normalizedStatus.includes('절판')) {
                statusText = '절판';
                statusClass = "bg-red-500/10 text-red-400 border-red-500/20";
            } else if (normalizedStatus.includes('print') || normalizedStatus.includes('준비')) {
                statusText = '재쇄 준비중';
                statusClass = "bg-orange-500/10 text-orange-400 border-orange-500/20";
            }

            const badge = document.getElementById('bookStatusBadge');
            badge.innerText = statusText;
            badge.className = `px-3 py-1 rounded-sm text-xs font-bold uppercase tracking-widest border ${statusClass}`;

            // Basic Info
            document.title = `${book.title} - Kerygma Library`;
            document.getElementById('bookCover').src = book.cover || 'https://via.placeholder.com/300x450?text=No+Cover';
            
            document.getElementById('bookTitle').innerText = book.title;
            document.getElementById('bookSubtitle').innerText = book.subtitle || '';
            document.getElementById('bookAuthor').innerText = book.author;

            const tagContainer = document.getElementById('tagContainer');
            if(book.tags) {
                book.tags.forEach(tag => {
                    const span = document.createElement('span');
                    span.className = "px-2 py-1 text-[10px] font-bold uppercase tracking-widest text-slate-400 border border-slate-700 rounded-sm";
                    span.innerText = `${tag}`;
                    tagContainer.appendChild(span);
                });
            }

            // Purchase Links
            const linkContainer = document.getElementById('purchaseLinks');
            if (book.links && Array.isArray(book.links) && book.links.length > 0) {
                book.links.forEach(linkObj => {
                    const btn = document.createElement('a');
                    btn.href = linkObj.url;
                    btn.target = "_blank";
                    
                    // Unified styling for all buttons
                    let bgClass = "bg-slate-800 hover:bg-slate-700 border-white/10 text-slate-300";

                    btn.className = `block w-full text-center py-3 rounded-md text-sm font-bold transition-all duration-300 border ${bgClass} text-slate-300 flex items-center justify-center gap-2 shadow-lg`;
                    
                    btn.innerHTML = `<span>${linkObj.site}</span> <svg class="w-3 h-3 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path></svg>`;
                    linkContainer.appendChild(btn);
                });
            } else if (book.link) {
                const btn = document.createElement('a');
                btn.href = book.link;
                btn.target = "_blank";
                btn.className = "block w-full text-center py-3 rounded-md font-bold bg-blue-600 hover:bg-blue-500 text-white transition-all shadow-lg shadow-blue-900/20";
                btn.innerText = "구매 페이지로 이동";
                linkContainer.appendChild(btn);
            }

            // Description
            document.getElementById('bookDescription').innerHTML = book.long_desc || book.desc || "<p class='text-slate-500 italic'>상세 소개가 준비 중입니다.</p>";

            // Quotes
            if (book.quotes && book.quotes.length > 0) {
                const qSection = document.getElementById('quotesSection');
                const qContainer = document.getElementById('quotesContainer');
                qSection.classList.remove('hidden');
                book.quotes.forEach(q => {
                    const div = document.createElement('div');
                    div.className = "quote-card p-6 rounded-lg shadow-xl hover:translate-x-1 transition-transform duration-300";
                    div.innerHTML = `
                        <p class="text-xl text-slate-200 italic leading-relaxed mb-4">"${q.text}"</p>
                        <p class="text-right text-sm text-sky-400 font-bold uppercase tracking-widest">— ${q.cite}</p>
                    `;
                    qContainer.appendChild(div);
                });
            }

            // Bio
            if (book.author_bio) {
                document.getElementById('bioSection').classList.remove('hidden');
                document.getElementById('authorBio').innerHTML = book.author_bio;
            }

            // Reveal
            content.classList.remove('hidden');
            setTimeout(() => content.classList.remove('opacity-0'), 100);
        }
    </script>
</body>
</html>
